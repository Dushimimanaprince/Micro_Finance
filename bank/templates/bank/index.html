<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro Bank Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }

        :root {
            --primary: #2d7d79;
            --primary-dark: #1f5a57;
            --secondary: #1a5c58;
            --accent: #2d7d79;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #2d7d79;
            --dark: #0f0f0f;
            --dark-light: #1a1a1a;
            --dark-medium: #2a2a2a;
            --gray: #404040;
            --light: #ffffff;
            --white: #ffffff;
            --text: #f8f9fa;
            --text-muted: #9ca3af;
            --border: #404040;
            --shadow: rgba(0, 0, 0, 0.8);
            --gradient: linear-gradient(135deg, #2d7d79, #1a5c58);
            --gradient-card: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
            --gradient-purple: linear-gradient(135deg, #8b5cf6, #6d28d9);
            --gradient-orange: linear-gradient(135deg, #f59e0b, #d97706);
            --gradient-green: linear-gradient(135deg, #10b981, #059669);
            --gradient-blue: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #2a2a2a 100%);
            color: var(--text);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(45, 125, 121, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(26, 92, 88, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(45, 125, 121, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 0 20px; 
        }

        /* Header Styles */
        .header { 
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px 0; 
            box-shadow: 0 8px 32px var(--shadow);
            position: sticky; 
            top: 0; 
            z-index: 1000;
            border-bottom: 1px solid var(--border);
        }

        .nav { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            flex-wrap: wrap; 
            gap: 20px; 
        }

        .logo { 
            font-size: 2rem; 
            font-weight: 800; 
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none; 
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .logo i {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.2rem;
        }

        .logo:hover {
            transform: translateY(-2px);
        }

        .nav-links { 
            display: flex; 
            gap: 15px; 
            align-items: center; 
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            background: var(--gradient-card);
            border-radius: 50px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .user-profile:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(45, 125, 121, 0.3);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
            font-size: 1rem;
            overflow: hidden;
            border: 2px solid var(--primary);
            transition: all 0.3s ease;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text);
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .btn { 
            display: inline-flex; 
            align-items: center; 
            gap: 8px; 
            background: var(--gradient);
            color: var(--white); 
            padding: 12px 24px; 
            border-radius: 12px; 
            text-decoration: none; 
            font-size: 0.95rem; 
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover { 
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(45, 125, 121, 0.4);
        }

        .btn-requests {
            background: var(--gradient-purple);
        }

        .btn-requests:hover {
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        .btn-sends { 
            background: linear-gradient(135deg, #1f4f3f 0%, #2d5a4a 100%); /* Dark green gradient */
        }
        .btn-sends:hover { 
            box-shadow: 0 8px 25px rgba(31, 79, 63, 0.4); /* Dark green shadow */
        }

        .btn-logout {
            background: var(--gradient-orange);
        }

        .btn-logout:hover {
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        /* Main Content */
        .main-content {
            padding: 40px 0;
        }

        /* Balance Card */
        .balance-section {
            margin-bottom: 40px;
        }

        .balance-card {
            background: var(--gradient-card);
            border-radius: 25px;
            padding: 40px;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px var(--shadow);
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.6s ease-out;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--gradient);
        }

        .balance-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(45, 125, 121, 0.05), transparent);
            animation: shimmer 4s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .balance-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            position: relative;
            z-index: 2;
        }

        .balance-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--white);
            box-shadow: 0 8px 25px rgba(45, 125, 121, 0.4);
            transition: all 0.3s ease;
        }

        .balance-icon:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .balance-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .balance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            position: relative;
            z-index: 2;
        }

        .balance-item {
            text-align: center;
            padding: 25px;
            background: rgba(45, 125, 121, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(45, 125, 121, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .balance-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(45, 125, 121, 0.1), rgba(26, 92, 88, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .balance-item:hover::before {
            opacity: 1;
        }

        .balance-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(45, 125, 121, 0.3);
        }

        .balance-label {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 15px;
            position: relative;
            z-index: 2;
        }

        .balance-amount {
            font-size: 2.8rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .balance-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            position: relative;
            z-index: 2;
        }

        .balance-change.positive {
            color: var(--success);
        }

        .balance-change.negative {
            color: var(--error);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* Chart Section */
        .chart-container {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px var(--shadow);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out 0.2s both;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-blue);
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
        }

        .chart-btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-muted);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .chart-btn.active,
        .chart-btn:hover {
            background: var(--gradient);
            color: var(--white);
            border-color: var(--primary);
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        /* Quick Stats */
        .quick-stats {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stat-card {
            background: var(--gradient-card);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient);
        }

        .stat-card:hover {
            transform: translateX(5px);
            box-shadow: 0 15px 35px rgba(45, 125, 121, 0.2);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--white);
            transition: all 0.3s ease;
        }

        .stat-icon:hover {
            transform: scale(1.1);
        }

        .stat-icon.users { background: var(--gradient-blue); }
        .stat-icon.transactions { background: var(--gradient-green); }
        .stat-icon.pending { background: var(--gradient-orange); }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .stat-sublabel {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 5px;
            font-style: italic;
        }

        /* Requests Section */
        .requests-section {
            margin-top: 40px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            position: relative;
        }

        .section-header h2 {
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-header::after {
            content: '';
            flex: 1;
            height: 2px;
            background: var(--gradient);
            border-radius: 2px;
            margin-left: 20px;
        }

        .requests-container {
            background: var(--gradient-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px var(--shadow);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out 0.4s both;
        }

        .requests-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-purple);
        }

        .request-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border);
            margin-bottom: 15px;
            transition: all 0.3s ease;
            background: rgba(139, 92, 246, 0.05);
        }

        .request-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.2);
            background: rgba(139, 92, 246, 0.1);
        }

        .request-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gradient-purple);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden; /* crop overflowing image */
        }

        .request-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;  /* scale and crop to fill */
            border-radius: 50%; /* ensure image itself is circular */
        }


        .request-details {
            flex: 1;
        }

        .request-name {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 5px;
        }

        .request-amount {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
        }

        .request-time {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .request-actions {
            display: flex;
            gap: 10px;
        }

        .request-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .request-btn.approve {
            background: var(--success);
            color: var(--white);
        }

        .request-btn.approve:hover {
            background: #0d9668;
            transform: translateY(-1px);
        }

        .request-btn.reject {
            background: var(--error);
            color: var(--white);
        }

        .request-btn.reject:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .balance-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }

            .nav {
                flex-direction: column;
                gap: 15px;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .balance-card {
                padding: 25px 20px;
            }

            .balance-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .balance-amount {
                font-size: 2.2rem;
            }

            .chart-wrapper {
                height: 250px;
            }

            .request-item {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .request-actions {
                width: 100%;
                justify-content: center;
            }

            .user-info {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 1.4rem;
            }

            .balance-amount {
                font-size: 1.8rem;
            }

            .stat-value {
                font-size: 1.5rem;
            }

            .btn {
                padding: 10px 16px;
                font-size: 0.85rem;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .quick-stats .stat-card:nth-child(1) { animation-delay: 0.3s; }
        .quick-stats .stat-card:nth-child(2) { animation-delay: 0.4s; }
        .quick-stats .stat-card:nth-child(3) { animation-delay: 0.5s; }

        /* Loading Animation */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(45, 125, 121, 0.3);
            border-left: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--error);
            color: var(--white);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    {% load humanize %}

<header class="header">
    <div class="container nav">
        <a href="#" class="logo">
            <i class="fas fa-university"></i> 
            Micro Bank Admin
        </a>
        <div class="nav-links">
            <a href="{% url 'transfer' %}" class="btn btn-sends" id="requestsBtn">
                <i class="fas fa-clipboard-list"></i> 
                Send Money

            </a>
        <div class="nav-links">
            <a href="{% url 'requests' %}" class="btn btn-requests" id="requestsBtn">
                <i class="fas fa-clipboard-list"></i> 
                Request Payement

            </a>
    <div class="user-profile" onclick="toggleUserMenu()">

    <div class="user-avatar">
        {% if profiles.profile %}
            <img src="{{ profiles.profile.url }}" alt="{{ profiles.user.username }}">
        {% else %}
            <!-- No image: show first letter of username -->
            <div class="avatar-placeholder">
                {{ profiles.user.username|first|upper }}
            </div>
        {% endif %}
    </div>

    <div class="user-info">
        <div class="user-name">{{ profiles.user.username }}</div>
        <div class="user-role">
            {% if profiles.user.is_superuser %}
                Admin
            {% elif profiles.user.is_staff %}
                Staff
            {% else %}
                Member
            {% endif %}
        </div>
        </div>

        <i class="fas fa-chevron-down" style="transition: transform 0.3s ease;"></i>
    </div>


            <a href="{% url 'login' %}" class="btn btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> 
                Logout
            </a>
        </div>
    </div>
    </div>
</header>

<div class="container main-content">

    <!-- Balance Section -->
    <div class="balance-section">
        <div class="balance-card">
            <div class="balance-header">
                <div class="balance-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="balance-title">Bank Overview</div>
            </div>
            <div class="balance-grid">
                <div class="balance-item">
                    <div class="balance-label">Total Balance</div>
                    <div class="balance-amount" id="totalBalance">$ {{user_wallet.balance|floatformat:"-2"|intcomma}}</div>
                    <div class="balance-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +12.5% from last month
                    </div>
                </div>
                <div class="balance-item">
                    <div class="balance-label">Available Funds</div>
                    <div class="balance-amount" id="availableFunds">$ {{total_balance|floatformat:"-2"|intcomma}}</div>
                    <div class="balance-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +8.3% from last month
                    </div>
                </div>
                <div class="balance-item">
                    <div class="balance-label">Pending Loans</div>
                    <div class="balance-amount" id="pendingLoans"> $ {{user_wallet.loan_balance|floatformat:"-2"|intcomma}}</div>
                    <div class="balance-change negative">
                        <i class="fas fa-arrow-down"></i>
                        -2.1% from last month
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
        <!-- Chart Section -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">
                    <i class="fas fa-chart-area"></i>
                    Financial Overview
                </div>
                <div class="chart-controls">
                    <button class="chart-btn active" onclick="updateChart('week')">7D</button>
                    <button class="chart-btn" onclick="updateChart('month')">1M</button>
                    <button class="chart-btn" onclick="updateChart('year')">1Y</button>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="financialChart"></canvas>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon users">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                </div>
                {% if reque %}
                <div class="stat-value" id="recentRequestAmount">${{reque.amount|floatformat:"-2"|intcomma}}</div>
                <div class="stat-label">Recent Request</div>
                <div class="stat-sublabel">{{reque.requester.username}} - {{reque.purpose}}</div>
                {%else%}
                    No Request 
                {%endif%}
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon transactions">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                </div>
                {% if txn %}
                        <div class="stat-value" id="recentTransferAmount">$ {{txn.amount|floatformat:"-2"|intcomma}}</div>
                        <div class="stat-label">Recent Sending Transfer</div>
                        <div class="stat-sublabel">Sent To: {{txn.receiver.username}}</div>
                {%else%}
                    No Sendin Transaction Yet
                    
                {%endif%}
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon pending">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                </div>
                {% if txn %}
                        <div class="stat-value" id="recentTransferAmount">$ {{txn.amount|floatformat:"-2"|intcomma}}</div>
                        <div class="stat-label">Recent Receiving Transfer</div>
                        <div class="stat-sublabel">Received From: {{txn.sender.username}}</div>
                {%else%}
                    No Recent Received Transaction Yet
                
                {%endif%}
            </div>
        </div>
    </div>

    <!-- Requests Section -->
    
        <div class="requests-section" id="requests">
            <div class="section-header">
                <h2><i class="fas fa-clipboard-list"></i> Recent Requests</h2>
            </div>
            <div class="requests-container">
                {% for req in requests%}
                <div class="request-item">
                    {% if req.requester.userprofile.profile%}
                    <div class="request-avatar">
                        <img src="{{ req.requester.userprofile.profile.url }}" alt="{{ req.requester.username }}">
                    </div>
                    {%else%}
                    <div class="request-avatar">
                        {{ req.requester.username|slice:"1"|upper }}
                    </div>
                    {%endif%}
                    <div class="request-details">
                        <div class="request-name">{{req.requester.username}}</div>
                        <div class="request-amount">{{req.purpose}}: ${{req.amount|floatformat:"-2"|intcomma}}</div>
                        <div class="request-time">{{req.request_at|timesince}} ago </div>
                    </div>
                    <div class="request-actions">
                        <form method="POST" action="{% url 'approve' req.id%}">
                            {% csrf_token %}
                            <button class="request-btn approve" >
                                <i class="fas fa-check"></i> Approve
                            </button>
                        </form>
                        <form method="POST" action="{% url 'reject' req.id%}">
                            {% csrf_token %}
                        <button class="request-btn reject" >
                            <i class="fas fa-times"></i> Reject
                        </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
                
                
                
            </div>
        </div>


</div>

<script>
    // Chart.js Configuration
    let financialChart;
    
    // Sample data for different time periods
    const chartData = {
        week: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Total Balance',
                data: [2800000, 2820000, 2850000, 2830000, 2870000, 2850000, 2847592],
                borderColor: '#2d7d79',
                backgroundColor: 'rgba(45, 125, 121, 0.1)',
                fill: true,
                tension: 0.4
            }, {
                label: 'Available Funds',
                data: [1900000, 1910000, 1920000, 1915000, 1925000, 1920000, 1923847],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        month: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            datasets: [{
                label: 'Total Balance',
                data: [2700000, 2750000, 2800000, 2847592],
                borderColor: '#2d7d79',
                backgroundColor: 'rgba(45, 125, 121, 0.1)',
                fill: true,
                tension: 0.4
            }, {
                label: 'Available Funds',
                data: [1800000, 1850000, 1900000, 1923847],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        year: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
                label: 'Total Balance',
                data: [2200000, 2300000, 2350000, 2400000, 2500000, 2600000, 2650000, 2700000, 2750000, 2800000, 2820000, 2847592],
                borderColor: '#2d7d79',
                backgroundColor: 'rgba(45, 125, 121, 0.1)',
                fill: true,
                tension: 0.4
            }, {
                label: 'Available Funds',
                data: [1500000, 1600000, 1650000, 1700000, 1750000, 1800000, 1820000, 1850000, 1870000, 1900000, 1910000, 1923847],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                fill: true,
                tension: 0.4
            }]
        }
    };

    // Initialize Chart
    function initChart() {
        const ctx = document.getElementById('financialChart').getContext('2d');
        financialChart = new Chart(ctx, {
            type: 'line',
            data: chartData.week,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#f8f9fa',
                            font: {
                                family: 'Inter',
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(15, 15, 15, 0.9)',
                        titleColor: '#f8f9fa',
                        bodyColor: '#f8f9fa',
                        borderColor: '#2d7d79',
                        borderWidth: 1
                    }
                },
                scales: {
                    x: {
                        grid: {
                            color: 'rgba(64, 64, 64, 0.3)'
                        },
                        ticks: {
                            color: '#9ca3af',
                            font: {
                                family: 'Inter',
                                size: 11
                            }
                        }
                    },
                    y: {
                        grid: {
                            color: 'rgba(64, 64, 64, 0.3)'
                        },
                        ticks: {
                            color: '#9ca3af',
                            font: {
                                family: 'Inter',
                                size: 11
                            },
                            callback: function(value) {
                                return ' + (value / 1000000).toFixed(1) + 'M';
                            }
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                animation: {
                    duration: 1000,
                    easing: 'easeInOutQuart'
                }
            }
        });
    }

    // Update Chart Function
    function updateChart(period) {
        // Update active button
        document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // Update chart data
        financialChart.data = chartData[period];
        financialChart.update('active');
    }

    // Handle Request Actions
    function handleRequest(action, name) {
        const actionText = action === 'approve' ? 'approved' : 'rejected';
        
        // Show loading state
        event.target.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        event.target.disabled = true;
        
        // Simulate API call
        setTimeout(() => {
            // Remove the request item with animation
            const requestItem = event.target.closest('.request-item');
            requestItem.style.transform = 'translateX(100%)';
            requestItem.style.opacity = '0';
            
            setTimeout(() => {
                requestItem.remove();
                
                // Update pending count
                const badge = document.querySelector('.notification-badge');
                const currentCount = parseInt(badge.textContent);
                if (currentCount > 0) {
                    badge.textContent = currentCount - 1;
                    if (currentCount - 1 === 0) {
                        badge.style.display = 'none';
                    }
                }
                
                // Update pending requests stat
                const pendingElement = document.getElementById('recentBillAmount');
                const currentPending = parseInt(pendingElement.textContent.replace(/[$,]/g, ''));
                // Generate new random bill amount between $500-$1500
                const newBillAmount = Math.floor(Math.random() * 1000) + 500;
                animateNumber({
                    set textContent(value) {
                        pendingElement.textContent = '
                
                // Show success notification
                showNotification(`Request from ${name} has been ${actionText}!`, action === 'approve' ? 'success' : 'warning');
            }, 300);
        }, 1500);
    }

    // Show Notification
    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: ${type === 'success' ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #f59e0b, #d97706)'};
            color: white;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            font-weight: 600;
            max-width: 300px;
        `;
        notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${message}`;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 100);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(400px)';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Toggle User Menu (placeholder for future functionality)
    function toggleUserMenu() {
        const chevron = document.querySelector('.user-profile i:last-child');
        chevron.style.transform = chevron.style.transform === 'rotate(180deg)' ? 'rotate(0deg)' : 'rotate(180deg)';
        
        // Placeholder for dropdown menu
        showNotification('User menu clicked! (Feature coming soon)', 'info');
    }

    // Logout Function
    function logout() {
        if (confirm('Are you sure you want to logout?')) {
            // Simulate logout process
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging out...';
            btn.style.pointerEvents = 'none';
            
            setTimeout(() => {
                showNotification('Logged out successfully!', 'success');
                // Here you would redirect to login page
                // window.location.href = '/login';
            }, 1500);
        }
    }

    // Animate Numbers
    function animateNumber(element, start, end, duration = 1000) {
        const range = end - start;
        const increment = range / (duration / 16);
        let current = start;
        
        const timer = setInterval(() => {
            current += increment;
            if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                current = end;
                clearInterval(timer);
            }
            element.textContent = Math.floor(current).toLocaleString();
        }, 16);
    }

    // Format Numbers with Animation
    function formatAndAnimateBalance() {
        const balanceElements = [
            { element: document.getElementById('totalBalance'), target: 2847592 },
            { element: document.getElementById('availableFunds'), target: 1923847 },
            { element: document.getElementById('pendingLoans'), target: 923745 },
            { element: document.getElementById('totalUsers'), target: 1247 },
            { element: document.getElementById('totalTransactions'), target: 8394 },
            { element: document.getElementById('pendingRequests'), target: 23 }
        ];
        
        balanceElements.forEach((item, index) => {
            setTimeout(() => {
                const isBalance = item.element.id.includes('Balance') || item.element.id.includes('Funds') || item.element.id.includes('Loans');
                const prefix = isBalance ? ' : '';
                
                item.element.textContent = prefix + '0';
                
                animateNumber({
                    ...item.element,
                    set textContent(value) {
                        item.element.textContent = prefix + parseInt(value).toLocaleString();
                    }
                }, 0, item.target, 2000);
            }, index * 200);
        });
    }

    // Smooth Scroll to Requests
    document.getElementById('requestsBtn').addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('requests').scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
    });

    // Add Loading States
    function addLoadingStates() {
        const buttons = document.querySelectorAll('.btn, .request-btn');
        buttons.forEach(button => {
            button.addEventListener('click', function(e) {
                if (!this.classList.contains('chart-btn') && !this.hasAttribute('onclick')) {
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                    this.style.pointerEvents = 'none';
                    
                    setTimeout(() => {
                        this.innerHTML = originalText;
                        this.style.pointerEvents = 'auto';
                    }, 2000);
                }
            });
        });
    }

    // Hover Effects for Stats
    function addHoverEffects() {
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.addEventListener('mouseenter', () => {
                const value = card.querySelector('.stat-value');
                const currentValue = parseInt(value.textContent.replace(/[$,]/g, ''));
                let randomIncrease, newValue;
                
                // Different hover effects for different cards
                switch(index) {
                    case 0: // Recent Request
                        randomIncrease = Math.floor(Math.random() * 5000) + 1000;
                        newValue = Math.min(50000, currentValue + randomIncrease);
                        break;
                    case 1: // Recent Transfer
                        randomIncrease = Math.floor(Math.random() * 1000) + 500;
                        newValue = Math.min(10000, currentValue + randomIncrease);
                        break;
                    case 2: // Recent Bill
                        randomIncrease = Math.floor(Math.random() * 200) + 50;
                        newValue = Math.min(2000, currentValue + randomIncrease);
                        break;
                    default:
                        randomIncrease = Math.floor(Math.random() * 10) + 1;
                        newValue = currentValue + randomIncrease;
                }
                
                animateNumber({
                    set textContent(val) {
                        value.textContent = '

    // Initialize everything when page loads
    window.addEventListener('load', () => {
        initChart();
        formatAndAnimateBalance();
        addLoadingStates();
        addHoverEffects();
    });

    // Add some real-time updates simulation
    setInterval(() => {
        const elements = ['totalBalance', 'availableFunds'];
        elements.forEach(id => {
            const element = document.getElementById(id);
            const currentValue = parseInt(element.textContent.replace(/[$,]/g, ''));
            const change = Math.floor(Math.random() * 1000) - 500; // Random change between -500 and +500
            const newValue = Math.max(0, currentValue + change);
            
            animateNumber({
                set textContent(value) {
                    element.textContent = ' + parseInt(value).toLocaleString();
                }
            }, currentValue, newValue, 1000);
        });
    }, 30000); // Update every 30 seconds

    // Add keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 'r':
                    e.preventDefault();
                    document.getElementById('requests').scrollIntoView({ behavior: 'smooth' });
                    break;
                case 'b':
                    e.preventDefault();
                    document.querySelector('.balance-section').scrollIntoView({ behavior: 'smooth' });
                    break;
            }
        }
    });

    // Add page visibility API for real-time updates
    document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') {
            // Refresh data when page becomes visible
            formatAndAnimateBalance();
            
            // Update chart
            if (financialChart) {
                financialChart.update('none');
            }
        }
    });

    // Performance optimization - Intersection Observer for animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.animationPlayState = 'running';
            }
        });
    }, observerOptions);

    // Observe animated elements
    document.querySelectorAll('.balance-card, .chart-container, .stat-card, .requests-container').forEach(el => {
        observer.observe(el);
    });
</script>

</body>
</html> 